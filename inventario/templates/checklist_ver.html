{% extends 'base.html' %}
{% block title %}Checklist {{ chk.fecha }} | {{ super() }}{% endblock %}
{% block content %}
<h3>Checklist Operación - {{ chk.fecha }}</h3>
<p class="text-muted small">Capturado por: {{ chk.usuario.username if chk.usuario else 'N/A' }} — {{ chk.created_at }}</p>
{% if chk.fecha == hoy %}
<div class="mb-2">
  <a href="{{ url_for('web.checklist_editar', chk_id=chk.id) }}" class="btn btn-sm btn-primary">Editar (hoy)</a>
</div>
{% endif %}
{% if chk.comentarios %}<div class="alert alert-info py-2"><strong>Comentarios:</strong> {{ chk.comentarios }}</div>{% endif %}
<div class="table-responsive">
  <table class="table table-bordered table-sm align-middle">
  <thead class="table-light"><tr><th>Servicio</th><th>Responsable</th><th>Hora</th><th>Imagen</th><th style="width:8%">Estado</th><th style="width:12%">Operador</th><th>Observación</th></tr></thead>
    <tbody>
    {% for it in chk.items %}
      <tr class="{% if it.estado=='Alerta' %}table-danger{% elif it.estado=='OK' %}table-success{% endif %}">
        <td>{{ it.servicio }}</td>
        <td>{{ it.responsable }}</td>
        <td>{{ it.hora_objetivo }}</td>
        <td class="text-center">{% if it.imagen_ref %}
          <a href="{{ url_for('static', filename='actividades/' ~ it.imagen_ref) }}" target="_blank" title="Ver imagen completa">
            <img src="{{ url_for('static', filename='actividades/' ~ it.imagen_ref) }}" alt="img {{ it.servicio }}" class="thumb-img" loading="lazy">
          </a>
        {% else %}-{% endif %}</td>
  <td>{{ it.estado }}</td>
  <td>{{ it.operador }}</td>
        <td style="white-space:pre-wrap">{{ it.observacion }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
<a href="{{ url_for('web.checklist_historial') }}" class="btn btn-secondary btn-sm">Volver</a>
{% endblock %}
