{% extends 'base.html' %}
{% block title %}Checklists | {{ super() }}{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="mb-0">Historial Checklists</h3>
  <a href="{{ url_for('web.checklist_nuevo') }}" class="btn btn-sm btn-success">Nuevo Checklist</a>
</div>
<table class="table table-striped table-sm">
  <thead class="table-light">
    <tr><th>Fecha</th><th>Usuario</th><th>Items OK</th><th>Items Alerta</th><th>Acciones</th></tr>
  </thead>
  <tbody>
  {% for r in registros %}
    {% set ok = r.items|selectattr('estado','equalto','OK')|list|length %}
    {% set alerta = r.items|selectattr('estado','equalto','Alerta')|list|length %}
    <tr>
      <td>{{ r.fecha }}</td>
      <td>{{ r.usuario.username if r.usuario else '-' }}</td>
      <td>{{ ok }}</td>
      <td class="{{ 'text-danger fw-bold' if alerta>0 else '' }}">{{ alerta }}</td>
      <td><a href="{{ url_for('web.checklist_ver', chk_id=r.id) }}" class="btn btn-sm btn-outline-primary">Ver</a></td>
    </tr>
  {% endfor %}
  </tbody>
</table>
<nav>
  <ul class="pagination pagination-sm">
    {% if prev_page %}<li class="page-item"><a class="page-link" href="?page={{ prev_page }}">«</a></li>{% endif %}
    <li class="page-item active"><span class="page-link">{{ page }}</span></li>
    {% if next_page %}<li class="page-item"><a class="page-link" href="?page={{ next_page }}">»</a></li>{% endif %}
  </ul>
</nav>
{% endblock %}
